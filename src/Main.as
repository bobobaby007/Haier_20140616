package  {	import flash.display.MovieClip;	import flash.events.MouseEvent;	import flash.events.Event;	import AsPreloader.Preloader;	import gs.TweenLite	public class Main extends MovieClip{		static public var _self:Main		private var _preloader:Preloader=new Preloader()		private var _currentPage:String		private var _savingDemoImage:Boolean=false		public function Main() {			_self=this			this.addEventListener(Event.ADDED_TO_STAGE,addToStageHander)		}			private function addToStageHander(event:Event){			setup()			}		private function setup(){						addChild(DouBan._Self)			DouBan._Self.setup()			removeChild(DouBan._Self)						_preloader.setColor(0xffffff)			_preloader.x=0			_preloader.y=20			PreloaderM._self.addChild(_preloader)									DouBan._Self.addEventListener(DouBan.EVENT_CONTECT_OK,doubanHander)			DouBan._Self.addEventListener(DouBan.EVENT_SAVEIMAGE_OK,doubanHander)					DouBan._Self.addEventListener(DouBan.EVENT_SAVEPNG_OK,doubanHander)					stage.addEventListener(Event.RESIZE,resizeHander)			resizeHander(null)																		showIt()								//_Page="startPage"		}		private function resizeHander(event:Event){										this.scaleX=this.scaleY=MainStage._stageScale						x=0.5*stage.stageWidth									//MaskMain._self.width=(stage.stageWidth+200)/this.scaleY			//MaskMain._self.height=(stage.stageHeight+200)/this.scaleY			//y=0.5*stage.stageHeight/0.8		}		private function showIt(){						//DouBan._Self._counter()			DouBan._Self.addEventListener(DouBan.EVENT_GETINFO_OK,doubanHander)						DouBan._Self._getUserInfo()					PhoneDefaultPage._self._refreshStr("http://campaign.douban.com/files/campaign/haierx/default.html")			FinalePhoneQR._self._refreshStr("http://campaign.douban.com/files/campaign/haierx/default.html")			_Page="defaultPhonePage"						trace("showIt")					}		private function apiHander(event:Event){			switch(event.type){				case DouBan_API_v1.EVENT_ALL_OK:									break				case DouBan_API_v1.EVENT_GET_MMB_OK:								break			}		}				public function _saveImage(){			MaskMain._self._show()			PreloaderM._self._showAt(2)			MainStage._self.mouseEnabled=false			MainStage._self.mouseChildren=false						resizeHander(null)									_savingDemoImage=false			//MaskMain._self.visible=true			//Uploading._self._show()						//MaskMain._self.width=stage.stageWidth			//MaskMain._self.height=stage.stageHeight					DrawBoardContainer._self._Available=false						WorkBoard._self._refreshIt()			DouBan._Self._saveUrl="http://www.douban.com/campaign/haier_waterheater/?fi_id=haier_waterheater"			DouBan._Self.saveImage([{object:WorkBoard._self,x:0,y:0}],550,400)		}				public function _saveDemoImage(){			MaskMain._self._show()			_savingDemoImage=true			PreloaderM._self._showAt(1)			MainBg._self._forSave()			MainStage._self.mouseEnabled=false			MainStage._self.mouseChildren=false									DouBan._Self._saveUrl="http://www.douban.com/campaign/haier_waterheater2/?fi_id=haier_waterheater2"			DouBan._Self.saveImage([{object:MainBg._self._bgs,x:-160,y:0},{object:ItemsBoard._self,x:-160,y:480-MainBg._self._Movied}],640,1136)			//DouBan._Self.saveImage([{object:MainBg._self,x:-160,y:0}],640,1136)			//DouBan._Self._savePngToPool([{object:MainBgBgs._self,x:0,y:0}],960,1136)		}				private function doubanHander(event:Event){			switch(event.type){				case DouBan.EVENT_CONTECT_OK:					//NeedLog._self._hide()					//MaskMain._self.visible=false					Main._self._Page="startPage"					//showIt()					//NeedLog._self._go()									break				case DouBan.EVENT_GETINFO_OK:										WorkBoard._self._Name=DouBan._Self._userName					WorkBoard._self._Image=DouBan._Self._iconImage					OkMessage._self._Name=DouBan._Self._userName					OkMessage._self._Image=DouBan._Self._iconImage									break				case DouBan.EVENT_SAVEIMAGE_OK:					//MaskMain._self.visible=false					//Uploading._self._hide()					//OkMessage._self._show()					MaskMain._self._hide()					trace(DouBan._Self._picUrl)										PreloaderM._self._hide()					MainStage._self.mouseEnabled=true					MainStage._self.mouseChildren=true										if(_savingDemoImage){						PhonePage._self._refreshStr("http://campaign.douban.com/files/campaign/haierx/default.html?photo_id="+DouBan._Self._picId+"&user_id="+DouBan._Self._id)						_Page="gotoPhonePage"											}else{						_Page="donePage"					}									break				case DouBan.EVENT_SAVEPNG_OK:										_preloader.visible=false					MainStage._self.mouseEnabled=true					MainStage._self.mouseChildren=true																			break			}		}		public function set _Page(__set:String){			_currentPage=__set			MainStage._self._GATracker.trackPageview("page_"+_currentPage)			switch(_currentPage){								case "defaultPhonePage":					MaskMain._self._show()					PhoneDefaultPage._self._show()					NeedLog._self._hide()										TopBar._self._StepNum=1					TopBar._self._show()					AgeSelecterBoard._self._show()										OverRect._self._show()					StepButtons._self._StepNum=1					StepButtons._self._hide()					BottomPanel._self._hide()					ItemSelecter._self._hide()										ShareButtons._self._hide()					OkMessage._self._hide()					HandOrKeyboard._self._hide()					FinalePhoneQR._self._hide()					WorkBoard._self._hide()										MakingBoard._self._hideWater()					DrawBoardContainer._self._Available=false				break				case "needLog":					NeedLog._self._needLog()				 	MaskMain._self._show()					PhoneDefaultPage._self._hide()				break				case "needContact":					NeedLog._self._needContact()				 	MaskMain._self._show()					PhoneDefaultPage._self._hide()				break				case "startPage":						MaskMain._self._hide()					PhoneDefaultPage._self._hide()					NeedLog._self._hide()									TopBar._self._StepNum=1					TopBar._self._show()					AgeSelecterBoard._self._show()										OverRect._self._show()					StepButtons._self._StepNum=1					StepButtons._self._hide()					BottomPanel._self._hide()					ItemSelecter._self._hide()										ShareButtons._self._hide()					OkMessage._self._hide()					HandOrKeyboard._self._hide()					FinalePhoneQR._self._hide()					WorkBoard._self._hide()										MakingBoard._self._hideWater()					DrawBoardContainer._self._Available=false				break;				case "makingPage":					NeedLog._self._hide()										TopBar._self._StepNum=2					TopBar._self._show()					AgeSelecterBoard._self._hide()										OverRect._self._hide()					StepButtons._self._show()					StepButtons._self._StepNum=2					BottomPanel._self._show()							ItemSelecter._self._show()					ProductSelecter._self._hide()					ItemsBoard._self._Avilabled=true															ShareButtons._self._hide()					OkMessage._self._hide()					HandOrKeyboard._self._hide()					FinalePhoneQR._self._hide()					WorkBoard._self._hide()										MakingBoard._self._hideWater()					DrawBoardContainer._self._Available=false														break;				case "choosePage":						NeedLog._self._hide()									MaskMain._self._hide()					TopBar._self._StepNum=3					TopBar._self._show()					AgeSelecterBoard._self._hide()										OverRect._self._hide()					StepButtons._self._show()					StepButtons._self._StepNum=3					BottomPanel._self._show()							ItemSelecter._self._hide()					ProductSelecter._self._show()					ItemsBoard._self._Avilabled=false															ShareButtons._self._hide()					OkMessage._self._hide()					HandOrKeyboard._self._hide()					FinalePhoneQR._self._hide()					WorkBoard._self._hide()										MakingBoard._self._hideWater()					DrawBoardContainer._self._Available=false				break;								case "gotoPhonePage":					MaskMain._self._show()					PhonePage._self._show()				break								case "handOrKeyboard":					PhonePage._self._hide()										MaskMain._self._hide()					TopBar._self._StepNum=4					TopBar._self._show()					AgeSelecterBoard._self._hide()										OverRect._self._show()					StepButtons._self._show()					StepButtons._self._StepNum=4					BottomPanel._self._show()							ItemSelecter._self._hide()					ProductSelecter._self._hide()										ShareButtons._self._hide()					OkMessage._self._hide()					HandOrKeyboard._self._show()					FinalePhoneQR._self._hide()					WorkBoard._self._hide()										//MakingBoard._self._showWater()					DrawBoardContainer._self._Available=false				break				case "drawingPage":					PhonePage._self._hide()										MaskMain._self._hide()					TopBar._self._StepNum=4					TopBar._self._show()					AgeSelecterBoard._self._hide()										OverRect._self._hide()					StepButtons._self._show()					StepButtons._self._StepNum=4					BottomPanel._self._show()							ItemSelecter._self._hide()					ProductSelecter._self._hide()										ShareButtons._self._hide()					OkMessage._self._hide()					HandOrKeyboard._self._hide()						FinalePhoneQR._self._hide()					WorkBoard._self._hide()										MakingBoard._self._showWater()					DrawBoardContainer._self._Available=true				break;								case "donePage":									PhonePage._self._hide()										MaskMain._self._hide()					TopBar._self._StepNum=4					TopBar._self._hide()					AgeSelecterBoard._self._hide()										OverRect._self._hide()					StepButtons._self._hide()										BottomPanel._self._hide()							ItemSelecter._self._hide()					ProductSelecter._self._hide()										ShareButtons._self._show()						OkMessage._self._show()					HandOrKeyboard._self._hide()						FinalePhoneQR._self._show()					WorkBoard._self._show()										KeyBoardInputer._self._focusOut()										MakingBoard._self._showWater()					DrawBoardContainer._self._Available=false				break;							}		}		public function _again(){									ItemHander._self._clearItem()			ItemsBoard._self._clearItem()			MainBg._self._reset()			KeyBoardInputer._self._reset()			DrawBoardContainer._self._Clear()						_Page="startPage"		}			}	}