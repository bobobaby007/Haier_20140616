//-----updated 20111210package {	import flash.display.Sprite;	import flash.net.URLRequest;	import flash.display.Loader;	import flash.events.Event;	import flash.events.IOErrorEvent;	import flash.display.Graphics;	import flash.system.LoaderContext	import flash.display.MovieClip	import flash.display.Bitmap;	public class ImageLoader extends Sprite {		private var _width:Number;		private var _height:Number;		private var _mask:Sprite=new Sprite  ;		private var _squareWidth:Number=15;		private var _squareHeight:Number=15;		private var _scaleMode:String;		private var _loader:Loader=new Loader	    private var _url:String		public static var SHOW_ALL:String="SHOW_ALL";		public static var SHOW_ALL_AND_CENTER:String="SHOW_ALL_AND_CENTER";		public static var CROP:String="CROP";		public var _targetM:MovieClip		public var _listener:Function=null		public function ImageLoader(__url:String,__targetM:MovieClip,__width:Number=0,__height:Number=0,__listener:Function=null,__scaleMode:String="CROP") {			_width=__width;			_height=__height;			_scaleMode=__scaleMode;						_url=__url			_targetM=__targetM			_listener=__listener			loadPic(__url);		}		private function loaderHander(event:Event) {			//var __m=event.target.content;			_mask.graphics.clear();			_mask.graphics.beginFill(0xffffff);			_mask.graphics.drawRect(0,0,_width,_height);			_mask.graphics.endFill();						var __m=_loader			try{				var bitMap:Bitmap=_loader.content as Bitmap				bitMap.smoothing=true			}catch(error){							}												var __w=__m.width;			var __h=__m.height;			if (_width!=0) {				__m.width=_width;				__m.height=_width*__h/__w;			} else {				_width=__m.width;			}			if (_height!=0) {				switch (_scaleMode) {					case SHOW_ALL :						if (__m.height>_height) {							__m.height=_height;							__m.width=_height*__w/__h;						}						_height=__m.height;						_width=__m.width;						break;					case CROP :												if (__m.height<_height) {							__m.height=_height;							__m.width=_height*__w/__h;						}						__m.x=.5*(_width-__m.width);						__m.y=.5*(_height-__m.height);												addChild(_mask);												__m.mask=_mask;						break;					case SHOW_ALL_AND_CENTER :						if (__m.height>_height) {							__m.height=_height;							__m.width=_height*__w/__h;						}						_height=__m.height;						_width=__m.width;						__m.x=-.5*__m.width;						__m.y=-.5*__m.height;						break;				}			} else {				_height=__m.height;			}			addChild(__m);			//_loader.contentLoaderInfo.addEventListener(Event.COMPLETE,loaderHander);			//_loader.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR,errorHander);			var _n=_targetM.numChildren;			for (var i:int=0; i<_n; i++) {				_targetM.removeChildAt(0);			}			_targetM.addChild(this)			if(_listener!=null){				_listener.call(this)			}		}		public function get Width():Number {			return _width;		}		public function get Height():Number {			return _height;		}		public function get Url():String{			return _url;		}		private function errorHander(event:IOErrorEvent) {			trace(event);		}		public function loadPic(__url:String) {			//trace(__url)			var __urlRequest:URLRequest=new URLRequest(__url);			var _loaderContext:LoaderContext=new LoaderContext()			_loaderContext.checkPolicyFile=true			_loader.contentLoaderInfo.addEventListener(Event.COMPLETE,loaderHander);			_loader.contentLoaderInfo.addEventListener(IOErrorEvent.IO_ERROR,errorHander);			_loader.load(__urlRequest,_loaderContext);						}		static public function loadAt(__url:String,__targetM:MovieClip,__width:Number=0,__height:Number=0,__listener:Function=null,__scaleMode:String="CROP"){			var _image=new ImageLoader(__url,__targetM,__width,__height,__listener,__scaleMode)		}	}}