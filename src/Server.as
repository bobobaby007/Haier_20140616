package  {	import flash.events.Event;	import flash.events.ErrorEvent		import flash.net.URLVariables	import flash.net.URLLoader;	import flash.net.URLRequest;	import flash.net.URLRequestMethod	import com.adobe.serialization.json.JSON		import flash.net.URLRequestHeader;	import flash.errors.IOError;	import flash.events.IOErrorEvent;	import flash.events.EventDispatcher;	import AsPreloader.Preloader;			public class Server extends EventDispatcher{		static public var _basicSaveUrl:String="http://biz.douban.com/cell/"		static public var _saveInfoUrl:String="http://biz.douban.com/cell/"		static public var _getting:Boolean=false		static public var _postting:Boolean=false		static public var _debug:int=0				//private var _saveInfoUrl:String="http://biz.douban.com/cell/demo/"				static private var _server:Server				static public var EVENT_POST_OK:String="EVENT_POST_OK"						static public var EVENT_GET_OK:String="EVENT_GET_OK"						static public var _uid:String=""		static public var _ck:String=""		static public var _getResult:Array				public function Server() {				checkDouban()			addEventListener(Server.EVENT_GET_OK,serverHander)			addEventListener(Server.EVENT_POST_OK,serverHander)		}		private function checkDouban(){			_uid=DouBan._Self._id			_ck=DouBan._Self._ck			_saveInfoUrl=_basicSaveUrl+DouBan._Self._siteName+"/"			if(DouBan._Self._uid=="user_uid"){				_debug=1			}else{				_debug=0			}		}		static public function get _Server():Server{			if(!_server){								_server=new Server()			}			return _server		}						//-----------发布新任务		public function _post(__object:Object){							checkDouban()									_postting=true			var _docs:Object=__object						var _date:Date=new Date			_docs.DateTime=_date.time									var _docsStr:String=JSON.encode(_docs)			trace(_docsStr)												var _urlR:URLRequest=new URLRequest(_saveInfoUrl)			_urlR.method=URLRequestMethod.POST						var urlVars:URLVariables=new URLVariables						urlVars.docs=_docsStr						urlVars.debug=_debug								urlVars.user_id=_uid			urlVars.ck=_ck						_urlR.data=urlVars						var _urlLoader:URLLoader=new URLLoader						_urlLoader.addEventListener(Event.COMPLETE,postHander)			_urlLoader.load(_urlR)		}		private function postHander(event:Event){			_postting=false			trace(event.target.data)			this.dispatchEvent(new Event(EVENT_POST_OK))		}				//----删除所有任务--		public function _delete(__object:Object){						checkDouban()					var _docs:Object=__object			var _docsStr:String=JSON.encode(_docs)									var _urlR:URLRequest=new URLRequest(_saveInfoUrl)			_urlR.method=URLRequestMethod.POST						var urlVars:URLVariables=new URLVariables						urlVars.docs=_docsStr						urlVars.debug=_debug						urlVars.is_delete=1						urlVars.user_id=_uid			urlVars.ck=_ck						_urlR.data=urlVars								var _urlLoader:URLLoader=new URLLoader			_urlLoader.addEventListener(Event.COMPLETE,deleteMissionHander)			_urlLoader.load(_urlR)		}		private function deleteMissionHander(event:Event){			trace(event.target.data)		}		//------取得数据		public function _get(_object:Object,_resultNum:int=100000){				_getting=true			var _docs:Object=_object								var _docsStr:String=JSON.encode(_docs)			_docsStr=escape(_docsStr)						//trace(_docsStr)			var _sortStr:String=escape("{'DateTime'}")						var _url:String=_saveInfoUrl+"?criteria="+_docsStr+"&batch_size="+_resultNum+"&debug="+_debug			trace(_url)			var _urlR:URLRequest=new URLRequest(_url)			var _urlLoader:URLLoader=new URLLoader()			_urlLoader.addEventListener(Event.COMPLETE,getHander)			_urlLoader.load(_urlR)					}		private function getHander(event:Event){			_getting=false			trace("---getHander----")			trace(event.target.data)				trace("-------")			var t:Object=JSON.decode(event.target.data)									try{				_getResult=t.results				trace(_getResult)			}catch(error){							}						this.dispatchEvent(new Event(EVENT_GET_OK))		}				//------		private function serverHander(event:Event){					}	}			}