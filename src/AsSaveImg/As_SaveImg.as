//------2011-02-11package  AsSaveImg{	import flash.display.Bitmap	import flash.display.BitmapData	import flash.net.FileReference	import flash.net.URLRequest	import flash.net.URLRequestMethod	import flash.net.URLLoader	import flash.events.IOErrorEvent	import flash.events.Event	import flash.net.URLLoaderDataFormat	import flash.display.DisplayObject;		import flash.utils.ByteArray	import flash.geom.Matrix;	public class As_SaveImg {		private var _completeHandler:Function		private var _errorHandler:Function		public var _urlLoader:URLLoader=new URLLoader				private var bitmapData:BitmapData		public function As_SaveImg(_width:Number,_height:Number) {			bitmapData=new BitmapData(_width,_height,true,0x00000000);					}		public function drawObject(_object:DisplayObject,__x:Number=0,__y:Number=0){			var _matrix:Matrix=new Matrix			_matrix.tx=__x			_matrix.ty=__y			bitmapData.draw(_object,_matrix);		}		public function saveJPG(_saveUrl:String,__completeHandler:Function=null,__errorHandler:Function=null){							_completeHandler=__completeHandler							_errorHandler=__errorHandler						var downfile: FileReference = new FileReference();			//var bitmapData:BitmapData = new BitmapData(_width,_height);//			//			bitmapData.draw(_object);//			if(_addObject){//				bitmapData.draw(_addObject)//			}			var bitmap:Bitmap = new Bitmap(bitmapData);			var jpg:JPEGEncoder = new JPEGEncoder(95);			jpg.encode(bitmapData);			jpg.addEventListener("complete",complete);			jpg.addEventListener("process",process);			function process(e:Event):void			{							}			function complete(e:Event):void			{									var req:URLRequest = new URLRequest(_saveUrl);				//data值就为图片编码数据ByteArray;  				req.data = jpg.byteout;				req.method = URLRequestMethod.POST;				//这个是关键,内容类型必须是下面文件流形式;  				req.contentType = "application/octet-stream";								//loader.dataFormat=URLLoaderDataFormat.BINARY;								_urlLoader.addEventListener(Event.COMPLETE, completeHandler);				_urlLoader.addEventListener(IOErrorEvent.IO_ERROR,errorHandler);				_urlLoader.addEventListener(Event.OPEN,progressHandler);								_urlLoader.load(req);			}		}	//-----------------------------png--------		public function savePNG(_saveUrl:String,__completeHandler:Function=null,__errorHandler:Function=null){					_completeHandler=__completeHandler					_errorHandler=__errorHandler				var dat:ByteArray=PNGEnc.encode(bitmapData);		var request:URLRequest=new URLRequest(_saveUrl);		request.contentType="application/octet-stream";		request.data=dat;		request.method=URLRequestMethod.POST;				_urlLoader.dataFormat=URLLoaderDataFormat.BINARY;		_urlLoader.addEventListener(Event.COMPLETE,completeHandler);		_urlLoader.addEventListener(IOErrorEvent.IO_ERROR,errorHandler);		_urlLoader.load(request);					}	public function completeHandler(event:Event){		if(_completeHandler!=null){			_completeHandler.call(null,event)		}	}	public function errorHandler(event:IOErrorEvent){		if(_errorHandler!=null){			_errorHandler.call(event.target,event)		}	}	public function progressHandler(event:Event){			}	//------------------------end	}	}